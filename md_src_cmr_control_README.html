<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Terra: cmr_control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Terra
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="namespacecmr__control.html">cmr_control</a> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Code related to hardware control of the rover.</p>
<p >An Overview of ROS 2 Control can be found <a href="https://control.ros.org/master/doc/getting_started/getting_started.html#">here</a>.</p>
<p >This package primarily provides implementations of Controllers and Hardware Interfaces.</p>
<p >A Hardware Interface is essentially what is used to implement communication with the physical hardware. It provides a way to read and/or write data to sensors and actuators. We can either have a Sensor, Actuator, or System Interface (the latter is essentially a combination of the two formers). An example of this would be the <code><a class="el" href="classcmr__control_1_1DrivesSystemHardware.html" title="Hardware interface for the drives system of the rover, which consists of a number of wheel motors and...">cmr_control::DrivesSystemHardware</a></code>.</p>
<p >A Controller (or Broadcaster) is essentially what is used to implement the topic interface we use from other nodes to communicate with the hardware interface. It is configured from YAML files. An example of this would be the <code><a class="el" href="classcmr__control_1_1AstroSensorBroadcaster.html" title="The AstroSensorBroadcaster is a broadcaster which publishes AstroTech sensor data (or really any floa...">cmr_control::AstroSensorBroadcaster</a></code>.</p>
<p >We currently have:</p><ul>
<li><code><a class="el" href="classcmr__control_1_1AstroSensorHardware.html" title="AstroSensorHardware is a hardware interface for the astro sensor that provides readings of a sensor&#39;s...">cmr_control::AstroSensorHardware</a></code></li>
<li><code><a class="el" href="classsemantic__components_1_1AstroSensor.html" title="The AstroSensor class is a semantic component which represents an sensor returning one or multiple fl...">semantic_components::AstroSensor</a></code></li>
<li><code><a class="el" href="classcmr__control_1_1AstroSensorBroadcaster.html" title="The AstroSensorBroadcaster is a broadcaster which publishes AstroTech sensor data (or really any floa...">cmr_control::AstroSensorBroadcaster</a></code></li>
<li><code><a class="el" href="classcmr__control_1_1DrivesSystemHardware.html" title="Hardware interface for the drives system of the rover, which consists of a number of wheel motors and...">cmr_control::DrivesSystemHardware</a></code></li>
<li><code><a class="el" href="classcmr__control_1_1ArmSystemHardware.html" title="ArmSystemHardware is a hardware interface for the arm that provides velocity and position control to ...">cmr_control::ArmSystemHardware</a></code></li>
</ul>
<p >The Controllers are configured via a YAML file which contains parameters that link up a controller and hardware interface. A hardware interface must be "connected" to a joint or other object within the URDF via the <code>&lt;ros2_control&gt;</code> tag</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Steps to adding a new Hardware Component:</h1>
<ol type="1">
<li>Create a Hardware Interface that subtypes from the correct base class. Skip this step if you will reuse an existing one. Make sure the interface uses <code>PLUGINLIB_EXPORT_CLASS</code> macro to register itself with <a href="https://docs.ros.org/en/foxy/Tutorials/Beginner-Client-Libraries/Pluginlib.html">pluginlib</a></li>
<li>Make sure the Hardware Interface is added to <code>hardware.xml</code> and the <code>CMakeLists.txt</code></li>
<li><p class="startli">Create a Xacro macro to instantiate the ROS2 control components. This will go in the <code>ros2_control</code> folder in the <code>&lt;...&gt;_description</code> folder along with the <code>urdf</code> folder and other description directories. Here's an example: <em>Note</em>: The usage of a macro isn't strictly necessary</p>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div>
<div class="line">&lt;<span class="keywordtype">robot</span> <span class="keyword">xmlns:xacro</span>=<span class="stringliteral">&quot;http://www.ros.org/wiki/xacro&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xacro:macro</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;astro_motor_ros2_control&quot;</span> <span class="keyword">params</span>=<span class="stringliteral">&quot;name joint&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">ros2_control</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;${name}&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;actuator&quot;</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">hardware</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">plugin</span>&gt;<span class="keyword">cmr_control</span>/<span class="keyword">AstroMotor</span>&lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">            &lt;/<span class="keywordtype">hardware</span>&gt;</div>
<div class="line">            &lt;<span class="keywordtype">joint</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;${joint}&quot;</span>&gt;</div>
<div class="line">                &lt;<span class="keywordtype">command_interface</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;position&quot;</span> /&gt;</div>
<div class="line">                &lt;<span class="keywordtype">command_interface</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;velocity&quot;</span> /&gt;</div>
<div class="line">                &lt;<span class="keywordtype">state_interface</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;position&quot;</span>/&gt;</div>
<div class="line">                &lt;<span class="keywordtype">state_interface</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;velocity&quot;</span>/&gt;</div>
<div class="line">            &lt;/<span class="keywordtype">joint</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">ros2_control</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">xacro:macro</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">robot</span>&gt;</div>
</div><!-- fragment --></li>
<li><p class="startli">Call the XACRO macro from the main URDF file. Here's an example:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">xacro:include</span> <span class="keyword">filename</span>=<span class="stringliteral">&quot;$(find cmr_drives_description)/ros2_control/astro_motor.ros2_control.xacro&quot;</span> /&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">xacro:astro_motor_ros2_control</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;test_astro_motor&quot;</span> <span class="keyword">joint</span>=<span class="stringliteral">&quot;test_astro_joint&quot;</span> /&gt;</div>
</div><!-- fragment --></li>
<li><p class="startli">Add the hardware interface to a controllers yaml config file to indicate which controller will provide the topic interface for your hardware. Example:</p>
<div class="fragment"><div class="line">controller_manager:</div>
<div class="line">    ros__parameters:</div>
<div class="line">        update_rate: 10 #Hz</div>
<div class="line"> </div>
<div class="line">        joint_state_broadcaster:</div>
<div class="line">            # Doc -&gt; https://github.com/ros-controls/ros2_controllers/blob/master/joint_state_broadcaster/doc/userdoc.rst</div>
<div class="line">            type: joint_state_broadcaster/JointStateBroadcaster</div>
<div class="line"> </div>
<div class="line">        astro_motor_pos_controller:</div>
<div class="line">            type: position_controllers/JointGroupPositionController</div>
<div class="line"> </div>
<div class="line">        astro_motor_vel_controller:</div>
<div class="line">            type: velocity_controllers/JointGroupVelocityController</div>
<div class="line"> </div>
<div class="line">astro_motor_pos_controller:</div>
<div class="line">    ros__parameters:</div>
<div class="line">        joints:</div>
<div class="line">        - test_astro_joint</div>
<div class="line"> </div>
<div class="line">astro_motor_vel_controller:</div>
<div class="line">    ros__parameters:</div>
<div class="line">        joints:</div>
<div class="line">        - test_astro_joint</div>
</div><!-- fragment --></li>
<li><p class="startli">Launch your controller for the hardware interface from the launch file. Example:</p>
<div class="fragment"><div class="line">astro_motor_controllers = PathJoinSubstitution(</div>
<div class="line">    [FindPackageShare(<span class="stringliteral">&quot;cmr_control&quot;</span>), <span class="stringliteral">&quot;config&quot;</span>, <span class="stringliteral">&quot;astro_motor_controllers.yaml&quot;</span>]</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">control_node = Node(</div>
<div class="line">    package=<span class="stringliteral">&quot;controller_manager&quot;</span>,</div>
<div class="line">    executable=<span class="stringliteral">&quot;ros2_control_node&quot;</span>,</div>
<div class="line">    parameters=[robot_description, robot_controllers, astro_broadcasters, astro_motor_controllers],</div>
<div class="line">    output=<span class="stringliteral">&quot;both&quot;</span>,</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># ...</span></div>
<div class="line"> </div>
<div class="line">astro_motor_pos_controller_spawner = Node(</div>
<div class="line">    package=<span class="stringliteral">&quot;controller_manager&quot;</span>,</div>
<div class="line">    executable=<span class="stringliteral">&quot;spawner&quot;</span>,</div>
<div class="line">    arguments=[<span class="stringliteral">&quot;astro_motor_pos_controller&quot;</span>, <span class="stringliteral">&quot;-c&quot;</span>, <span class="stringliteral">&quot;/controller_manager&quot;</span>],</div>
<div class="line">    condition=IfCondition(PythonExpression(</div>
<div class="line">        [astro_motor_mode, <span class="stringliteral">&quot; == &#39;position&#39;&quot;</span>]</div>
<div class="line">    ))</div>
<div class="line">)</div>
</div><!-- fragment --></li>
</ol>
<p >You can find further information <a href="https://control.ros.org/master/doc/ros2_control/hardware_interface/doc/writing_new_hardware_interface.html">here</a> for adding a HW interface and <a href="https://control.ros.org/foxy/doc/ros2_controllers/doc/writing_new_controller.html">here</a> for adding a controller.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Some notes about HW Interfaces</h1>
<p >Each HW interface typically has state interfaces and command interfaces. The HW interface typically has member variables for each state and command interface it provides. The command interface value is set by the controller when it receives commands on the topics is subscribes to. The state interfaces value is what the hardware interface reads and writes. They should reflect the current state (ex. velocity, position) of the motor or sensor the HW interface corresponds to.</p>
<p >The method <code>prepare_command_mode_switch</code> is called with a vector of interface names being passed to a HW interface. Note that <code>prepare_command_mode_switch</code> may be called with a set of command interfaces not relevant to the HW interface, and when that occurs the call should be ignored. The vector names represents the new command modes being requested for each joint under the HW interface's control. Each string in the vector will be of the form <code>JOINT_NAME/NEW_COMMAND_MODE_NAME</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Apr 27 2024 20:02:34 for Terra by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
